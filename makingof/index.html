<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>De Casa al Cole</title>

  <meta name="description" content="Herramienta para ordenar coles">
  <meta name="author" content="Jorge Sanz">

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="shortcut icon" type="image/png" href="../images/favicon.ico" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="../reveal/css/reveal.min.css">
  <link rel="stylesheet" href="../reveal/css/theme/serif.css" id="theme">
  <link rel="stylesheet" href="style.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- For syntax highlighting -->
  <link rel="stylesheet" href="../reveal/lib/css/zenburn.css">

  <!-- If the query includes 'print-pdf', include the PDF print sheet -->
  <script>
  if (window.location.search.match(/print-pdf/gi)) {
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = '../reveal/css/print/pdf.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  }
  </script>

  <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
</head>

<body>

  <div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
      <section class="frontpage">
        <div>
            <img src="../images/logo100.png" style="height:300px;" class="noframe">
        </div>
        <div>
          <h1>Making of</h1>
        </div>
        <div>
            <p>
              Jorge Sanz · <a href="http://twitter.com/xurxosanz">@xurxosanz</a><br>
              <a href="http://decasaalcole.github.io/talks/makingof">decasaalcole.github.io/talks/makingof</a>
            </p>
        </div>
      </section>

      <!-- Primera parte Motivación -->
      <section>
        <section>
          <h1><i class="fa fa-plug fa-lg"></i></h1>
          <h2>Motivación</h2>
        </section>
        <section>
          <h2><strong>problema</strong>:</h2>
          <h3>¿qué colegios están
            <strong>cerca</strong> de mi casa?</h3>
        </section>
        <section>
          <h2>¿<strong>quién</strong> tiene este problema?</h2>
        </section>
        <section>
          <h2><strong>Profesionales</strong> de la educación en
            concurso de traslado y <strong>padres</strong></h2>
        </section>

        <section>
          <h2>¿cómo ordenarías <strong>todos</strong> los colegios de la CV (&#8776;3.000) en
            función del <strong>tiempo de viaje</strong> hasta tu casa?</h2>
        </section>
        <section>
          <h2>¿calcular <strong>uno a uno</strong>
              todos los trayectos?</h2>
        </section>
        <section>
            <div>
              <img src="../images/facepalm.jpg">
            </div>
        </section>
        <section>
            <div>
              <img src="../images/logo100.png" class="noframe" style="width:20%;">
            </div>
            <blockquote>
              <h2>&laquo;<strong>acortamos</strong> el camino hacia la
                <strong>decisión</strong> inteligente&raquo;</h2>
            </blockquote>
        </section>
        <section>
            <h2><strong>¿cómo?</strong><br/>
              desarrollando un sistema de
              <em>ordenación</em> de colegios en función del
              <em>tiempo</em> de viaje</h2>
        </section>
        <section style="font-size:3em;color:rgb(51,61,61);">
          <span class="fragment fade-in" data-fragment-index="1">
            <span class="fragment highlight-red" data-fragment-index="1">
              <i class="fa fa-database fa-lg"></i><br/>
            </span>
          </span>
          <span class="fragment fade-in" data-fragment-index="2">
            <span class="fragment highlight-red" data-fragment-index="2">
              <i class="fa fa-cloud"></i> =
              <i class="fa fa-map-marker"></i> +
              <i class="fa fa-cogs"></i> <br/>
            </span>
          </span>
          <span class="fragment fade-in" data-fragment-index="3">
            <span class="fragment highlight-red" data-fragment-index="3">
            <i class="fa fa-globe"></i> =
            <i class="fa fa-desktop"></i> +
            <i class="fa fa-mobile"></i>
          </span>
        </section>
      </section>

      <!-- Segunda parte los datos -->
      <section>
        <section>
          <h1><i class="fa fa-database fa-lg"></i></h1>
          <h2>Los datos</h2>
          <h3>Colegios + Códigos Postales</h3>
        </section>
        <section>
          <h2>Colegios</h2>
          <ul>
            <li>Publicados por la
              <a href="http://www.cece.gva.es/ocd/areacd/es/descargas.htm">GVA</a></li>
            <li>&#8776;<strong>3500</strong> registros</li>
            <li>Primero en <tt>mdb</tt>, ahora en <tt><strong>ods</strong></tt>
                y <tt>pdf</tt> </li>
            <li>Nombre, datos de contacto, dirección postal,<br/>
                <strong>coordenadas geográficas</strong>, régimen</li>
            <li>ODS
              <i class="fa fa-long-arrow-right"></i> CSV
              <i class="fa fa-long-arrow-right"></i> <strong>SHP</strong>
              <i class="fa fa-long-arrow-right"></i> <i class="fa fa-database fa-lg"></i></li>
          </ul>
        </section>
        <section>
          <h2>Colegios</h2>
          <ul>
            <li>A nivel nacional el
              <a href="https://www.educacion.gob.es/centros/home.do">MinEd</a>
              publica en HTML <i class="fa fa-frown-o fa-lg"></i></li>
            <li class="fragment fade-in">Estamos trabajando en ello...</li>
            <li class="fragment fade-in">Pero ese tema para otro día</li>
          </ul>
        </section>
        <section>
          <h2>Códigos postales</h2>
          <ul>
            <li>Punteado <strong>a mano</strong> el centro urbano<br/>
              de cada código postal</li>
            <li><strong>SHP</strong>
              <i class="fa fa-long-arrow-right"></i> <i class="fa fa-database fa-lg"></i></li>
          </ul>
        </section>
        <section>
          <h2>Preparación de datos de OSM</h2>
          <ul>
            <li>¡OpenStreetMap es una <strong>base de datos</strong>!</li>
            <li>Descarga del <strong>PBF</strong> de España
              de <a href="http://download.geofabrik.de/europe/spain.html">Geofabrik</a> </li>
            <li>Con <a href="https://wiki.openstreetmap.org/wiki/Osmosis">Osmosis</a> se recorta y aligera
              <ul>
                <li>Extración por coordenadas<br/>
                  con <tt>--bounding-box</tt> (<a href="https://wiki.openstreetmap.org/wiki/Osmosis#Extracting_bounding_boxes">doc</a>)</li>
                <li>Exracción de las vías<br/>
                  con <tt>--tag-filter</tt> (<a href="https://wiki.openstreetmap.org/wiki/Osmosis/Detailed_Usage#--tag-filter_.28--tf.29">doc</a> ) </li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <div><img src="../images/osrm.png"
            style="width:50%;" alt="OSRM" class="noframe"></div>
          <h2>Cálculo masivo <br/> de tiempos de viaje</h2>
        </section>
        <section>
          <h2>¿Qué es <a href="https://github.com/Project-OSRM/osrm-backend/wiki">
            OSRM</a>?
          </h2>
          <ul>
            <li>Dos proyectos: <strong>servidor</strong> y cliente</li>
            <li>Servidor de cálculos de rutas altamente <strong>eficiente</strong></li>
            <li>Enfocado a usar datos de <strong>OpenStreetMap</strong></li>
          </ul>
        </section>
        <section>
          <h2>Poner en marcha OSRM</h2>
          <ol>
            <li>Descargar el código fuente de OSRM </li>
            <li>Compilar el <em>software</em></li>
            <li>Preparar la cartografía para un perfil (en coche)</li>
            <li>Arrancar el servidor y comprobar que funciona</li>
          </ol>
        </section>
        <section>
          <h2>Cálculo de tiempos de viaje</h2>
          <ul>
            <li>
              <a href="https://github.com/decasaalcole/decasaalcole-web/blob/master/process/process_cp.py">
                Script
              </a> en Python</li>
            <li>Carga un SHP de códigos postales</li>
            <li>Ordena por código</li>
            <li>Abre un CSV nuevo</li>
            <li>Recorre la lista de códigos postales pidiendo<br/>
              a OSRM el tiempo y distancia de
              <strong>ida y vuelta</strong></li>
            <li>Se generan <em>n*n-1</em> registros &#8776;
            <strong>600.000</strong> </li>
            <li class="fragment fade-in">CSV
              <i class="fa fa-long-arrow-right"></i>
              <strong>SHP</strong>
              <i class="fa fa-long-arrow-right"></i>
              <i class="fa fa-database fa-lg"></i>  &#128561;
              <ul>
                <li>No podemos subir tablas sin geometrías</li>
                <li>En CSV <strong>todo</strong> son cadenas de texto</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <img src="../images/dcac-times.png" alt="Tiempos" class="noframe">
        </section>
        <section>
          <h2>¿Por qué esta estructura?</h2>
          <ul>
            <li>Es más <strong>compacta</strong>, ahorra filas</li>
            <li>Pero <strong>complica</strong> las consultas</li>
            <li class="fragment fade-in">Peeeeeero cabe en una<br/> cuenta
              <strong>gratuita</strong> de CartoDB &#128519;</li>
          </ul>
        </section>
      </section>

      <!-- Tercera parte: los servicios -->
      <section>
        <section>
          <img class="noframe" src="../images/cartodb.png" alt="CartoDB" class="noframe">
        </section>
        <section>
          <div>
            <img class="noframe" src="../images/dcac-datasets.png" alt="Datasets de DCAC">
          </div>
          <p><a href="https://decasaalcole.cartodb.com/datasets">Datasets en CartoDB</a></p>
        </section>
        <section>
          <div>
            <img class="noframe" src="../images/dcac-coles-table.png" alt="Tabla de coles">
          </div>
          <p>Tabla de colegios</p>
        </section>
        <section>
          <div>
            <img class="noframe" src="../images/dcac-coles-map.png" alt="Mapa de coles">
          </div>
          <p>Mapa de colegios</p>
        </section>
        <section>
          <blockquote style="font-size:2em;line-height:1em;">
            <strong>Objetivo</strong>:<br/>
            Dado un código postal, <strong>cruzar</strong> la tabla de colegios
            con la de tiempos para <strong>asignar</strong> a cada uno el
            tiempo de viaje
          </blockquote>
        </section>
        <section>
          <pre style="font-size:.8em;line-height:1em;">
Dado
  "ftimes" como los tiempos y distancias
  de 46960 a todos los demás

Y
  "ttimes" como los tiempos y distancias
  de todos a 46960

Montamos "totaltimes" como
  ttimes + ftimes + (46960 al
  que les damos tiempo y distancia = 0)

Y así ya podemos:
  Cruzar coles con totaltimes
  por el campo cp

Y ordenamos el resultado por
  tiempos y distancias
          </pre>
        </section>
        <section>
          <img
            src="../images/dcac-sqlcoles.png"
            alt="SQL que ordena los coles" style="width:70%;">
        </section>
        <section>
          <h1><i class="fa fa-map-marker"></i></h1>
          <h2>Mapas dinámicos</h2>
        </section>
        <section>
          <div>
            <img src="../images/dcac-cartocss.png"
              alt="CartoCSS de DCAC" class="noframe">
          </div>
          <p>CartoCSS para generar mapa temático por distancias
            (<a href="http://cdb.io/1qpqIih">demo</a>)</p>
        </section>
        <section>
          <h2>CartoDB genera mapas dinámicos</h2>
          <ul>
            <li class="fragment fade-in">Podemos generar
              <strong>visualizaciones</strong> estáticas</li>
            <li class="fragment fade-in">Pero también las
              podemos generar <strong>&laquo;al vuelo&raquo;</strong></li>
            <li class="fragment fade-in">Establecer una
              <strong>consulta SQL</strong></li>
            <li class="fragment fade-in">Establecer un
              <strong>estilo CartoCSS</strong></li>
          </ul>
        </section>
        <section>
          <img src="../images/mind-blown.gif"
            alt="Mind Blown!" style="width:450px;">
        </section>
        <section>
          <h1><i class="fa fa-cogs"></i></h1>
          <h2>API de consulta</h2>
        </section>
        <section>
          <h2>¿Qué es una API?</h2>
          <ul>
            <li>Formato (y protocolo) para <br/>
              <strong>comunicarnos</strong> con un sistema</li>
            <li>WMS, WFS+GML, CSW, ...</li>
            <li class="fragment fade-in">
              CartoDB expone una API <strong>SQL</strong> <br/>
                que genera <strong>JSON</strong>, CSV, Shapfiles,...</li>
          </ul>
        </section>
        <section>
          <img class="noframe" src="../images/what.jpg" alt="What?">
        </section>
        <section>
          <h2>¿SQL?</h2>
        </section>
        <section>
          <a class="noicon" href="http://decasaalcole.cartodb.com/api/v2/sql?q=select%20count(*)%20cuentas%20from%20times;">
            http://decasaalcole.cartodb.com/api/v2/<br/>
            sql?q=<strong>select count(*) cuentas from times</strong>
          </a>
          <img src="../images/dcac-sql.png" alt="SQL">
        </section>
        <section>
          <a class="noicon" href="http://decasaalcole.cartodb.com/api/v2/sql?q=select%20*%20from%20times%20limit%203&format=csv">
            http://decasaalcole.cartodb.com/api/v2/<br/>
            sql?q=select * from times limit 3&amp;<strong>format=csv</strong></a>
          <img src="../images/dcac-sql-3.png" alt="SQL en CSV">
        </section>
        <section>
          <h2>¡Y por supuesto SQL espacial!</h2>
          <a class="noicon" href="http://decasaalcole.cartodb.com/api/v2/sql?q=select%20ST_AsText(ST_Buffer(the_geom%2C1))%20from%20cp%20limit%201">
            http://decasaalcole.cartodb.com/api/v2/<br/>
            sql?q=select <strong>st_astext(st_buffer(the_geom,1))</strong>
            from cp limit 1</a>
        </section>
        <section>
          <img src="../images/mind-blown-keanu.gif"
            style="width:550px;" alt="Mind Blown #2">
          <p class="fragment fade-in">Efectivamente, podeis ejecutar<br/>
            SQL espacial con <strong>cualquier</strong><br/>
            tabla que alguien publique en CartoDB</p>
        </section>
      </section>

      <!-- Cuarta parte: las aplicaciones -->
      <section>
        <section>
          <h1><i class="fa fa-globe"></i></h1>
          <h2>Desarrollo de los clientes</h2>
        </section>
        <section>
          <h1><i class="fa fa-desktop"></i></h1>
          <h2>Cliente web</h2>
        </section>
        <section>
          <h1><i class="fa fa-mobile"></i></h1>
          <h2>Cliente móvil</h2>
        </section>
      </section>

      <!-- Cierre -->
      <section class="frontpage">
        <div>
          <img src="../images/equipo-300.jpg" style="height:300px;" class="noframe">
        </div>
        <div>
          <h1>¿Preguntas?</h1>
        </div>
        <div>
            <p>
              Jorge Sanz · <a href="http://twitter.com/xurxosanz">@xurxosanz</a><br>
              <a href="http://decasaalcole.github.io/talks/makingof">decasaalcole.github.io/talks/makingof</a>
            </p>
        </div>
      </section>
    </div>
  </div>

  <script src="../reveal/lib/js/head.min.js"></script>
  <script src="../reveal/js/reveal.min.js"></script>

  <script>
  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    // Display controls in the bottom right corner
    controls: true,
    // Display a presentation progress bar
    progress: true,
    // Display the page number of the current slide
    slideNumber: false,
    // Push each slide change to the browser history
    history: true,
    // Enable keyboard shortcuts for navigation
    keyboard: true,
    // Enable the slide overview mode
    overview: true,
    // Vertical centering of slides
    center: true,
    // Enables touch navigation on devices with touch input
    touch: true,
    // Loop the presentation
    loop: true,
    // Change the presentation direction to be RTL
    rtl: false,
    // Turns fragments on and off globally
    fragments: true,
    // Flags if the presentation is running in an embedded mode,
    // i.e. contained within a limited portion of the screen
    embedded: false,
    // Number of milliseconds between automatically proceeding to the
    // next slide, disabled when set to 0, this value can be overwritten
    // by using a data-autoslide attribute on your slides
    autoSlide: 0,
    // Stop auto-sliding after user input
    autoSlideStoppable: true,
    // Enable slide navigation via mouse wheel
    mouseWheel: false,
    // Hides the address bar on mobile devices
    hideAddressBar: true,
    // Opens links in an iframe preview overlay
    previewLinks: false,
    // Transition style
    transition: 'fade', // default/cube/page/concave/zoom/linear/fade/none
    // Transition speed
    transitionSpeed: 'fast', // default/fast/slow
    // Transition style for full page slide backgrounds
    backgroundTransition: 'fade', // default/none/slide/concave/convex/zoom
    // Number of slides away from the current that are visible
    viewDistance: 3,
    // Parallax background image
    parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"
    // Parallax background size
    parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"


    // Optional libraries used to extend on reveal.js
    dependencies: [{
      src: '../reveal/lib/js/classList.js',
      condition: function() {
        return !document.body.classList;
      }
    }, {
      src: '../reveal/plugin/markdown/marked.js',
      condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
    }, {
      src: '../reveal/plugin/markdown/markdown.js',
      condition: function() {
        return !!document.querySelector('[data-markdown]');
      }
    }, {
      src: '../reveal/plugin/highlight/highlight.js',
      async: true,
      callback: function() {
        hljs.initHighlightingOnLoad();
      }
    }, {
      src: '../reveal/plugin/zoom-js/zoom.js',
      async: true,
      condition: function() {
        return !!document.body.classList;
      }
    }, {
      src: '../reveal/plugin/notes/notes.js',
      async: true,
      condition: function() {
        return !!document.body.classList;
      }
    }]
  });
  </script>

</body>

</html>
